{"ast":null,"code":"import { mapGetters } from 'vuex';\nimport { FilterMatchMode } from 'primevue/api';\nimport PedidoService from '@/service/PedidoService';\nimport ProductoSeleccionableDatatable from './ProductoSeleccionableDatatable.vue';\nexport default {\n  name: 'PedidoDatatable',\n  components: {\n    ProductoSeleccionableDatatable\n  },\n\n  data() {\n    return {\n      pedidos: null,\n      selectedRow: {\n        id: null,\n        estado: null,\n        productos: null,\n        precioTotal: null,\n        direccionEnvio: null,\n        metodoDePago: null,\n        numSeguimiento: null,\n        observaciones: null\n      },\n      editedRow: {\n        id: null,\n        estado: null,\n        productos: null,\n        precioTotal: null,\n        direccionEnvio: null,\n        metodoDePago: null,\n        numSeguimiento: null,\n        observaciones: null\n      },\n      isDisabled: true,\n      filters: null,\n      metodosDePago: null,\n      estados: null,\n      displayDialogPedidos: false\n    };\n  },\n\n  pedidoService: null,\n\n  created() {\n    this.pedidoService = new PedidoService();\n    this.initFilters();\n    this.metodosDePago = [\"Tarjeta\", \"Paypal\", \"Bizum\"];\n  },\n\n  computed: { ...mapGetters({\n      username: 'username',\n      keycloakToken: 'keycloakToken',\n      keycloakTokenParsed: 'keycloakTokenParsed',\n      axiosConfig: 'axiosConfig',\n      roles: 'roles'\n    })\n  },\n\n  mounted() {\n    if (this.keycloakToken != null) {\n      this.getAll();\n    }\n  },\n\n  watch: {\n    keycloakToken: function (val) {\n      if (val) {\n        this.pedidoService.getAll(this.axiosConfig).then(response => {\n          this.pedidos = response.data;\n        });\n      }\n    }\n  },\n  methods: {\n    save() {\n      try {\n        this.pedidoService.save(this.editedRow, this.axiosConfig).then(() => {\n          this.$toast.add({\n            severity: 'success',\n            summary: 'Guardando',\n            detail: 'REGISTRO CREADO CORRECTAMENTE. GUARDADO EN BASE DE DATOS',\n            life: 3000\n          });\n          this.getAll();\n          this.isDisabled = true;\n        }).catch(error => {\n          console.log('primer catch');\n          console.log(error);\n\n          if (error.response.status === 400) {\n            const errorMessage = error.response.data;\n            this.$toast.add({\n              severity: 'error',\n              summary: 'Error',\n              detail: errorMessage,\n              life: 3000\n            });\n          }\n        });\n      } catch (error) {\n        console.log('segundo catch');\n        console.log(error);\n        this.$toast.add({\n          severity: 'error',\n          summary: 'Error',\n          detail: 'No se pudo guardar el registro. Por favor, inténtalo de nuevo más tarde.',\n          life: 3000\n        });\n      }\n    },\n\n    create() {\n      this.isDisabled = false;\n      console.log('Hola create');\n      this.editedRow = {\n        id: null,\n        estado: null,\n        productos: null,\n        precioTotal: null,\n        direccionEnvio: null,\n        metodoDePago: null,\n        numSeguimiento: null,\n        observaciones: null\n      };\n    },\n\n    remove() {\n      try {\n        this.pedidoService.remove(this.editedRow.id, this.axiosConfig).then(() => {\n          this.$toast.add({\n            severity: 'success',\n            summary: 'Eliminando',\n            detail: 'REGISTRO ELIMINADO CORRECTAMENTE. BORRADO EN BASE DE DATOS',\n            life: 3000\n          });\n          this.getAll();\n          this.isDisabled = true;\n        });\n      } catch (error) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'Error',\n          detail: 'No se pudo eliminar el registro. Por favor, inténtalo de nuevo más tarde.',\n          life: 3000\n        });\n      }\n    },\n\n    getAll() {\n      this.pedidoService.getAll(this.axiosConfig).then(response => {\n        this.pedidos = response.data;\n      });\n    },\n\n    onRowSelect(event) {\n      this.editedRow = Object.assign({}, event.data);\n      this.isDisabled = false;\n    },\n\n    initFilters() {\n      this.filters = {\n        'global': {\n          value: null,\n          matchMode: FilterMatchMode.CONTAINS\n        },\n        'numSeguimiento': {\n          value: null,\n          matchMode: FilterMatchMode.CONTAINS\n        },\n        'nombre': {\n          value: null,\n          matchMode: FilterMatchMode.CONTAINS\n        },\n        'metodoDePago': {\n          value: null,\n          matchMode: FilterMatchMode.CONTAINS\n        },\n        'estado.nombre': {\n          value: null,\n          matchMode: FilterMatchMode.CONTAINS\n        },\n        'precioTotal': {\n          value: null,\n          matchMode: FilterMatchMode.CONTAINS\n        },\n        'direccionEnvio': {\n          value: null,\n          matchMode: FilterMatchMode.CONTAINS\n        },\n        'observaciones': {\n          value: null,\n          matchMode: FilterMatchMode.CONTAINS\n        }\n      };\n    },\n\n    openDialogPedidos() {\n      this.displayDialogPedidos = true;\n    },\n\n    closeDialogPedidos() {\n      this.$refs.productoSeleccionableDatatable.emitProductosSeleccionados();\n      this.displayDialogPedidos = false;\n    },\n\n    onProductosSeleccionados(productosSeleccionados) {\n      this.editedRow.productos = productosSeleccionados;\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["mapGetters","FilterMatchMode","PedidoService","ProductoSeleccionableDatatable","name","components","data","pedidos","selectedRow","id","estado","productos","precioTotal","direccionEnvio","metodoDePago","numSeguimiento","observaciones","editedRow","isDisabled","filters","metodosDePago","estados","displayDialogPedidos","pedidoService","created","initFilters","computed","username","keycloakToken","keycloakTokenParsed","axiosConfig","roles","mounted","getAll","watch","val","then","response","methods","save","$toast","add","severity","summary","detail","life","catch","error","console","log","status","errorMessage","create","remove","onRowSelect","event","Object","assign","value","matchMode","CONTAINS","openDialogPedidos","closeDialogPedidos","$refs","productoSeleccionableDatatable","emitProductosSeleccionados","onProductosSeleccionados","productosSeleccionados"],"sourceRoot":"","sources":["C:\\Users\\emalc\\OneDrive\\Escritorio\\CRUD_keycloak_primeVue\\keycloak-workshop\\frontend-vuejs\\src\\componentes\\PedidoDatatable.vue"],"sourcesContent":["<template>\r\n  <div style=\"margin: 0 auto; width: 80%\">\r\n    <p_panel header=\"Pedidos\">\r\n      <p:dataTable :value=\"pedidos\" :paginator=\"true\" :rows=\"10\" v-model:selection=\"selectedRow\"\r\n        class=\"p-datatable-pedidos\" @row-click=\"onRowSelect\" selectionMode=\"single\" dataKey=\"id\"\r\n        paginatorTemplate=\"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown\"\r\n        :rowsPerPageOptions=\"[10, 20, 50]\" responsiveLayout=\"scroll\" filterDisplay=\"row\" v-model:filters=\"filters\"\r\n        :globalFilterFields=\"['numSeguimiento', 'metodoDePago', 'estado.nombre', 'precioTotal', 'direccionEnvio', 'observaciones']\"\r\n        currentPageReportTemplate=\"Mostrando {first} a {last} de {totalRecords}\">\r\n        <template #header>\r\n          <div class=\"flex justify-content-end\">\r\n            <span class=\"p-input-icon-left \">\r\n              <i class=\"pi pi-search\" />\r\n              <p:inputText v-model=\"filters['global'].value\" placeholder=\"Buscar...\" />\r\n            </span>\r\n          </div>\r\n        </template>\r\n        <template #empty>\r\n          No hay pedidos disponibles.\r\n        </template>\r\n        <template #loading>\r\n          Cargando pedidos. por favor, espera.\r\n        </template>\r\n        <p_column field=\"numSeguimiento\" header=\"Nº de seguimiento\" filterMatchMode=\"contains\" ref=\"numSeguimiento\"\r\n          :sortable=\"true\">\r\n          <template #filter=\"{ filterModel, filterCallback }\">\r\n            <p:inputText type=\"text\" v-model=\"filterModel.value\" @keydown.enter=\"filterCallback()\"\r\n              class=\"p-column-filter\" placeholder=\"Buscar por nº de seguimiento \" />\r\n          </template>\r\n        </p_column>\r\n        <p_column field=\"metodoDePago\" header=\"Método de pago\" filterMatchMode=\"contains\" ref=\"metodoDePago\"\r\n          :sortable=\"true\">\r\n          <template #filter=\"{ filterModel, filterCallback }\">\r\n            <p:inputText type=\"text\" v-model=\"filterModel.value\" @keydown.enter=\"filterCallback()\"\r\n              class=\"p-column-filter\" placeholder=\"Buscar por método de pago \" />\r\n          </template>\r\n        </p_column>\r\n        <p_column field=\"estado.nombre\" header=\"Estado\" filterMatchMode=\"contains\" ref=\"estado.nombre\" :sortable=\"true\">\r\n          <template #filter=\"{ filterModel, filterCallback }\">\r\n            <p:inputText type=\"text\" v-model=\"filterModel.value\" @keydown.enter=\"filterCallback()\"\r\n              class=\"p-column-filter\" placeholder=\"Buscar por estado \" />\r\n          </template>\r\n        </p_column>\r\n        <p_column field=\"precioTotal\" header=\"Precio total\" filterMatchMode=\"contains\" ref=\"precioTotal\"\r\n          :sortable=\"true\">\r\n          <template #filter=\"{ filterModel, filterCallback }\">\r\n            <p:inputText type=\"number\" v-model=\"filterModel.value\" @keydown.enter=\"filterCallback()\"\r\n              class=\"p-column-filter\" placeholder=\"Buscar por precio \" />\r\n          </template>\r\n        </p_column>\r\n        <p_column field=\"direccionEnvio\" header=\"Dirección de envío\" filterMatchMode=\"contains\" ref=\"direccionEnvio\"\r\n          :sortable=\"true\">\r\n          <template #filter=\"{ filterModel, filterCallback }\">\r\n            <p:inputText type=\"text\" v-model=\"filterModel.value\" @keydown.enter=\"filterCallback()\"\r\n              class=\"p-column-filter\" placeholder=\"Buscar por dirección \" />\r\n          </template>\r\n        </p_column>\r\n        <p_column field=\"observaciones\" header=\"Observaciones\" filterMatchMode=\"contains\" ref=\"observaciones\"\r\n          :sortable=\"true\">\r\n          <template #filter=\"{ filterModel, filterCallback }\">\r\n            <p:inputText type=\"text\" v-model=\"filterModel.value\" @keydown.enter=\"filterCallback()\"\r\n              class=\"p-column-filter\" placeholder=\"Buscar por observaciones \" />\r\n          </template>\r\n        </p_column>\r\n      </p:dataTable>\r\n    </p_panel>\r\n  </div>\r\n  <p_panel style=\"margin-bottom: 20px;margin: 0 auto; width: 80%\">\r\n    <div style=\"display: inline-block; margin-right: 10px; vertical-align: middle;\">\r\n      <label for=\"numSeguimiento\" style=\"display: block;\">Nº de seguimiento</label>\r\n      <p:inputText id=\"numSeguimiento\" type=\"text\" v-model=\"this.editedRow.numSeguimiento\" :disabled=\"true\"\r\n        style=\"width: 200px;\" />\r\n    </div>\r\n\r\n    <div style=\"display: inline-block; margin-right: 10px; vertical-align: middle;\">\r\n      <label for=\"metodoDePago\" style=\"display: block;\">Método de pago</label>\r\n      <p:selectOneMenu id=\"metodoDePago\" v-model=\"this.editedRow.metodoDePago\" :disabled=\"isDisabled\"\r\n        style=\"width: 200px;\" :options=\"metodosDePago\" placeholder=\"Selecciona un método de pago\" />\r\n    </div>\r\n\r\n    <div style=\"display: inline-block; margin-right: 10px; vertical-align: middle;\">\r\n      <label for=\"estado\" style=\"display: block;\">Estado</label>\r\n      <p:selectOneMenu id=\"estado\" v-model=\"this.editedRow.estado\" :disabled=\"isDisabled\" style=\"width: 200px;\"\r\n        optionLabel=\"nombre\" placeholder=\"Selecciona un estado\" :options=\"estados\" />\r\n    </div>\r\n\r\n    <div style=\"display: inline-block; margin-right: 10px; vertical-align: middle;\">\r\n      <label for=\"productos\" style=\"display: block;\">Productos</label>\r\n      <p:commandButton id=\"productos\" label=\"Selecciona productos\" icon=\"pi pi-external-link\" @click=\"openDialogPedidos\"\r\n        :disabled=\"isDisabled\" style=\"vertical-align: middle;\" />\r\n      <p_dialog header=\"Selecciona los productos\" v-model:visible=\"displayDialogPedidos\"\r\n        :breakpoints=\"{ '960px': '75vw', '640px': '90vw' }\" :style=\"{ width: '50vw' }\">\r\n        <template #footer>\r\n          <ProductoSeleccionableDatatable ref=\"productoSeleccionableDatatable\"\r\n            @productosSeleccionados=\"onProductosSeleccionados\" />\r\n          <p:commandButton label=\"No\" icon=\"pi pi-times\" @click=\"closeDialogPedidos\" class=\"p-button-text\" />\r\n          <p:commandButton label=\"Yes\" icon=\"pi pi-check\" @click=\"closeDialogPedidos\" autofocus />\r\n        </template>\r\n      </p_dialog>\r\n    </div>\r\n    <div style=\"display: inline-block; margin-right: 10px; vertical-align: middle;\">\r\n      <label for=\"direccionEnvio\" style=\"display: block;\">Dirección de envío</label>\r\n      <p:inputText id=\"direccionEnvio\" type=\"text\" v-model=\"this.editedRow.direccionEnvio\" :disabled=\"isDisabled\"\r\n        style=\"width: 200px;\" />\r\n    </div>\r\n    <div style=\"display: inline-block; margin-right: 10px; vertical-align: middle;\">\r\n      <label for=\"precioTotal\" style=\"display: block;\">Precio total</label>\r\n      <p:inputText id=\"precioTotal\" type=\"number\" v-model=\"this.editedRow.precioTotal\" :disabled=\"isDisabled\"\r\n        style=\"width: 200px;\" />\r\n    </div>\r\n    <div style=\"display: inline-block; margin-right: 10px; vertical-align: middle;\">\r\n      <label for=\"observaciones\" style=\"display: block;\">Observaciones</label>\r\n      <p:inputText id=\"observaciones\" type=\"text\" v-model=\"this.editedRow.observaciones\" :disabled=\"isDisabled\"\r\n        style=\"width: 200px;\" />\r\n    </div>\r\n  </p_panel>\r\n\r\n  <div v-if=\"this.roles.includes('SUPER_USER')\">\r\n    <p_panel style=\"margin-bottom: 20px;margin: 0 auto; width: 80%\">\r\n      <div class=\"center-buttons\" style=\"margin: 0 auto; width: 80%; text-align: center;\">\r\n        <p:commandButton style=\"margin-right: 10px;\" label=\"Nuevo\" @click=\"create\" class=\"p-button-success mr-2\"\r\n          icon=\"pi pi-plus\"></p:commandButton>\r\n        <p:commandButton style=\"margin-right: 10px;\" label=\"Guardar\" @click=\"save\" icon=\"pi pi-save\" update=\"nombre\">\r\n        </p:commandButton>\r\n        <p:commandButton style=\"margin-right: 10px;\" label=\"Eliminar\" @click=\"remove\" class=\"p-button-danger\"\r\n          icon=\"pi pi-trash\"></p:commandButton>\r\n        <p:commandButton style=\"margin-right: 10px;\" label=\"Refrescar\" @click=\"getAll\" class=\"p-button-danger\"\r\n          icon=\"pi pi-refresh\"></p:commandButton>\r\n      </div>\r\n    </p_panel>\r\n\r\n  </div>\r\n  <p_toast></p_toast>\r\n</template>\r\n\r\n\r\n<script>\r\n\r\nimport { mapGetters } from 'vuex';\r\n\r\nimport { FilterMatchMode } from 'primevue/api';\r\nimport PedidoService from '@/service/PedidoService';\r\nimport ProductoSeleccionableDatatable from './ProductoSeleccionableDatatable.vue'\r\nexport default {\r\n  name: 'PedidoDatatable',\r\n  components: {\r\n    ProductoSeleccionableDatatable\r\n  },\r\n  data() {\r\n    return {\r\n      pedidos: null,\r\n      selectedRow: {\r\n        id: null,\r\n        estado: null,\r\n        productos: null,\r\n        precioTotal: null,\r\n        direccionEnvio: null,\r\n        metodoDePago: null,\r\n        numSeguimiento: null,\r\n        observaciones: null,\r\n      },\r\n      editedRow: {\r\n        id: null,\r\n        estado: null,\r\n        productos: null,\r\n        precioTotal: null,\r\n        direccionEnvio: null,\r\n        metodoDePago: null,\r\n        numSeguimiento: null,\r\n        observaciones: null,\r\n      },\r\n      isDisabled: true,\r\n      filters: null,\r\n      metodosDePago: null,\r\n      estados: null,\r\n      displayDialogPedidos: false,\r\n\r\n\r\n    }\r\n  },\r\n  pedidoService: null,\r\n  created() {\r\n    this.pedidoService = new PedidoService();\r\n    this.initFilters();\r\n    this.metodosDePago = [\"Tarjeta\", \"Paypal\", \"Bizum\"];\r\n  },\r\n  computed: {\r\n    ...mapGetters({\r\n      username: 'username',\r\n      keycloakToken: 'keycloakToken',\r\n      keycloakTokenParsed: 'keycloakTokenParsed',\r\n      axiosConfig: 'axiosConfig',\r\n      roles: 'roles',\r\n    })\r\n  },\r\n  mounted() {\r\n    if (this.keycloakToken != null) {\r\n      this.getAll();\r\n    }\r\n\r\n  },\r\n  watch: {\r\n    keycloakToken: function (val) {\r\n      if (val) {\r\n        this.pedidoService.getAll(this.axiosConfig).then(response => {\r\n          this.pedidos = response.data;\r\n        });\r\n\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    save() {\r\n      try {\r\n        this.pedidoService.save(this.editedRow, this.axiosConfig).then(() => {\r\n          this.$toast.add({ severity: 'success', summary: 'Guardando', detail: 'REGISTRO CREADO CORRECTAMENTE. GUARDADO EN BASE DE DATOS', life: 3000 })\r\n          this.getAll();\r\n          this.isDisabled = true;\r\n        })\r\n          .catch((error) => {\r\n            console.log('primer catch');\r\n            console.log(error);\r\n            if (error.response.status === 400) {\r\n              const errorMessage = error.response.data;\r\n              this.$toast.add({ severity: 'error', summary: 'Error', detail: errorMessage, life: 3000 });\r\n            }\r\n          });\r\n      } catch (error) {\r\n        console.log('segundo catch');\r\n        console.log(error);\r\n        this.$toast.add({ severity: 'error', summary: 'Error', detail: 'No se pudo guardar el registro. Por favor, inténtalo de nuevo más tarde.', life: 3000 });\r\n      }\r\n    },\r\n    create() {\r\n      this.isDisabled = false;\r\n      console.log('Hola create')\r\n      this.editedRow = {\r\n        id: null,\r\n        estado: null,\r\n        productos: null,\r\n        precioTotal: null,\r\n        direccionEnvio: null,\r\n        metodoDePago: null,\r\n        numSeguimiento: null,\r\n        observaciones: null,\r\n      };\r\n\r\n    },\r\n    remove() {\r\n      try {\r\n        this.pedidoService.remove(this.editedRow.id, this.axiosConfig).then(() => {\r\n          this.$toast.add({ severity: 'success', summary: 'Eliminando', detail: 'REGISTRO ELIMINADO CORRECTAMENTE. BORRADO EN BASE DE DATOS', life: 3000 })\r\n          this.getAll();\r\n          this.isDisabled = true;\r\n        });\r\n      } catch (error) {\r\n        this.$toast.add({ severity: 'error', summary: 'Error', detail: 'No se pudo eliminar el registro. Por favor, inténtalo de nuevo más tarde.', life: 3000 });\r\n      }\r\n    },\r\n    getAll() {\r\n      this.pedidoService.getAll(this.axiosConfig).then(response => {\r\n        this.pedidos = response.data;\r\n      });\r\n    },\r\n    onRowSelect(event) {\r\n      this.editedRow = Object.assign({}, event.data);\r\n      this.isDisabled = false;\r\n    },\r\n    initFilters() {\r\n      this.filters = {\r\n        'global': { value: null, matchMode: FilterMatchMode.CONTAINS },\r\n        'numSeguimiento': { value: null, matchMode: FilterMatchMode.CONTAINS },\r\n        'nombre': { value: null, matchMode: FilterMatchMode.CONTAINS },\r\n        'metodoDePago': { value: null, matchMode: FilterMatchMode.CONTAINS },\r\n        'estado.nombre': { value: null, matchMode: FilterMatchMode.CONTAINS },\r\n        'precioTotal': { value: null, matchMode: FilterMatchMode.CONTAINS },\r\n        'direccionEnvio': { value: null, matchMode: FilterMatchMode.CONTAINS },\r\n        'observaciones': { value: null, matchMode: FilterMatchMode.CONTAINS },\r\n      }\r\n    },\r\n    openDialogPedidos() {\r\n      this.displayDialogPedidos = true;\r\n    },\r\n    closeDialogPedidos() {\r\n      this.$refs.productoSeleccionableDatatable.emitProductosSeleccionados();\r\n      this.displayDialogPedidos = false;\r\n    },\r\n\r\n    onProductosSeleccionados(productosSeleccionados) {\r\n      this.editedRow.productos = productosSeleccionados;\r\n    }\r\n\r\n  }\r\n\r\n}\r\n\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n::v-deep(.p-datatable.p-datatable-pedidos) {\r\n  .p-datatable-header {\r\n    padding: 1rem;\r\n    text-align: left;\r\n    font-size: 1.5rem;\r\n  }\r\n\r\n  .p-paginator {\r\n    padding: 1rem;\r\n  }\r\n\r\n  .p-datatable-thead>tr>th {\r\n    text-align: left;\r\n  }\r\n\r\n  .p-datatable-tbody>tr>td {\r\n    cursor: auto;\r\n  }\r\n\r\n  .p-dropdown-label:not(.p-placeholder) {\r\n    text-transform: uppercase;\r\n  }\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}