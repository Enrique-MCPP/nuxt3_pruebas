{"ast":null,"code":"import { createApp } from 'vue';\nimport App from './App.vue';\nimport Keycloak from 'keycloak-js';\nimport PrimeVue from 'primevue/config';\nimport VTooltip from 'v-tooltip';\nimport 'primevue/resources/themes/nova/theme.css'; //import 'primevue/resources/themes/lara-light-indigo/theme.css'\n\nimport 'primevue/resources/primevue.min.css';\nimport 'primeicons/primeicons.css';\nimport Toast from 'primevue/toast';\nimport ToastService from 'primevue/toastservice';\nimport InputText from 'primevue/inputtext';\nimport DataTable from 'primevue/datatable';\nimport Column from 'primevue/column';\nimport Panel from 'primevue/panel';\nimport Menubar from 'primevue/menubar';\nimport Button from 'primevue/button';\nimport Dropdown from 'primevue/dropdown';\nimport Dialog from 'primevue/dialog';\nconst app = createApp(App);\napp.use(PrimeVue);\napp.use(ToastService);\napp.use(VTooltip);\napp.component('p:inputText', InputText);\napp.component('p_toast', Toast);\napp.component('p:dataTable', DataTable);\napp.component('p_column', Column);\napp.component('p:commandButton', Button);\napp.component('p_panel', Panel);\napp.component('p_menubar', Menubar);\napp.component('p:selectOneMenu', Dropdown);\napp.component('p_dialog', Dialog); // JSON VIEWER\n\nimport JsonViewer from \"vue3-json-viewer\";\nimport \"vue3-json-viewer/dist/index.css\";\napp.use(JsonViewer); // EVENTBUS\n\nimport mitt from 'mitt';\nconst emitter = mitt();\napp.config.globalProperties.emitter = emitter; // VUEX\n\nimport store from \"@/store/user\";\napp.use(store); // AXIOS\n\nimport axios from 'axios';\nimport VueAxios from 'vue-axios';\napp.use(VueAxios, axios); // KEYCLOAK\n\nconst initOptions = {\n  url: process.env.VUE_APP_KEYCLOAK_API_URL,\n  realm: process.env.VUE_APP_KEYCLOAK_REALM,\n  clientId: process.env.VUE_APP_KEYCLOAK_CLIENT_ID\n};\nconst keycloak = Keycloak(initOptions);\nkeycloak.init({\n  onLoad: 'login-required'\n}).then(() => {\n  let roles = keycloak.realmAccess.roles;\n  roles = roles.filter(role => !role.includes(\"offline_access\") && !role.includes(\"uma_authorization\") && !role.includes(\"default-roles-spring-boot-microservices-realm\"));\n  store.commit('setUserName', keycloak.tokenParsed.preferred_username);\n  store.commit('setKeycloakToken', keycloak.token);\n  store.commit('setKeycloakTokenParsed', keycloak.tokenParsed);\n  store.commit('setRoles', roles);\n  emitter.on('keycloak-logout', () => {\n    keycloak.logout();\n  }); // Token Refresh\n\n  setInterval(() => {\n    keycloak.updateToken(70).then(refreshed => {\n      if (refreshed) {\n        let roles = keycloak.realmAccess.roles;\n        roles = roles.filter(role => !role.includes(\"offline_access\") && !role.includes(\"uma_authorization\") && !role.includes(\"default-roles-spring-boot-microservices-realm\"));\n        store.commit('setUserName', keycloak.tokenParsed.preferred_username);\n        store.commit('setKeycloakToken', keycloak.token);\n        store.commit('setKeycloakTokenParsed', keycloak.tokenParsed);\n        store.commit('setRoles', roles);\n        console.info('Token refreshed' + refreshed);\n      } else {\n        console.warn('Token not refreshed, valid for ' + Math.round(keycloak.tokenParsed.exp + keycloak.timeSkew - new Date().getTime() / 1000) + ' seconds');\n      }\n    }).catch(() => {\n      keycloak.logout();\n    });\n  }, 60 * 1000);\n});\napp.mount('#app');","map":{"version":3,"sources":["C:/Users/emalc/OneDrive/Escritorio/CRUD_keycloak_primeVue/keycloak-workshop/frontend-vuejs/src/main.js"],"names":["createApp","App","Keycloak","PrimeVue","VTooltip","Toast","ToastService","InputText","DataTable","Column","Panel","Menubar","Button","Dropdown","Dialog","app","use","component","JsonViewer","mitt","emitter","config","globalProperties","store","axios","VueAxios","initOptions","url","process","env","VUE_APP_KEYCLOAK_API_URL","realm","VUE_APP_KEYCLOAK_REALM","clientId","VUE_APP_KEYCLOAK_CLIENT_ID","keycloak","init","onLoad","then","roles","realmAccess","filter","role","includes","commit","tokenParsed","preferred_username","token","on","logout","setInterval","updateToken","refreshed","console","info","warn","Math","round","exp","timeSkew","Date","getTime","catch","mount"],"mappings":"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","sourcesContent":["import { createApp } from 'vue'\r\nimport App from './App.vue'\r\nimport Keycloak from 'keycloak-js'\r\nimport PrimeVue from 'primevue/config';\r\nimport VTooltip from 'v-tooltip';\r\n\r\nimport 'primevue/resources/themes/nova/theme.css'\r\n//import 'primevue/resources/themes/lara-light-indigo/theme.css'\r\nimport 'primevue/resources/primevue.min.css'\r\nimport 'primeicons/primeicons.css'\r\nimport Toast from 'primevue/toast';\r\nimport ToastService from 'primevue/toastservice';\r\nimport InputText from 'primevue/inputtext';\r\nimport DataTable from 'primevue/datatable';\r\nimport Column from 'primevue/column';\r\nimport Panel from 'primevue/panel';\r\nimport Menubar from 'primevue/menubar';\r\n\r\nimport Button from 'primevue/button';\r\nimport Dropdown from 'primevue/dropdown';\r\nimport Dialog from 'primevue/dialog';\r\n\r\nconst app = createApp(App);\r\napp.use(PrimeVue);\r\napp.use(ToastService);\r\napp.use(VTooltip);\r\napp.component('p:inputText', InputText);\r\napp.component('p_toast', Toast);\r\napp.component('p:dataTable', DataTable);\r\napp.component('p_column', Column);\r\napp.component('p:commandButton', Button);\r\napp.component('p_panel', Panel);\r\napp.component('p_menubar', Menubar);\r\napp.component('p:selectOneMenu', Dropdown);\r\napp.component('p_dialog', Dialog);\r\n// JSON VIEWER\r\nimport JsonViewer from \"vue3-json-viewer\";\r\nimport \"vue3-json-viewer/dist/index.css\";\r\napp.use(JsonViewer);\r\n\r\n// EVENTBUS\r\nimport mitt from 'mitt';\r\nconst emitter = mitt();\r\napp.config.globalProperties.emitter = emitter;\r\n\r\n// VUEX\r\nimport store from \"@/store/user\";\r\napp.use(store)\r\n\r\n// AXIOS\r\nimport axios from 'axios'\r\nimport VueAxios from 'vue-axios'\r\napp.use(VueAxios, axios)\r\n\r\n\r\n// KEYCLOAK\r\nconst initOptions = {\r\n    url: process.env.VUE_APP_KEYCLOAK_API_URL,\r\n    realm: process.env.VUE_APP_KEYCLOAK_REALM,\r\n    clientId: process.env.VUE_APP_KEYCLOAK_CLIENT_ID,\r\n}\r\n\r\nconst keycloak = Keycloak(initOptions)\r\n\r\nkeycloak.init({ onLoad: 'login-required' }).then(() => {\r\n    let roles = keycloak.realmAccess.roles;\r\n    roles = roles.filter(role => !role.includes(\"offline_access\") && !role.includes(\"uma_authorization\") && !role.includes(\"default-roles-spring-boot-microservices-realm\"));\r\n    store.commit('setUserName', keycloak.tokenParsed.preferred_username)\r\n    store.commit('setKeycloakToken', keycloak.token)\r\n    store.commit('setKeycloakTokenParsed', keycloak.tokenParsed)\r\n    store.commit('setRoles', roles);\r\n\r\n    emitter.on('keycloak-logout', () => {\r\n        keycloak.logout()\r\n    })\r\n\r\n    // Token Refresh\r\n    setInterval(() => {\r\n        keycloak\r\n            .updateToken(70)\r\n            .then((refreshed) => {\r\n                if (refreshed) {\r\n                    let roles = keycloak.realmAccess.roles;\r\n                    roles = roles.filter(role => !role.includes(\"offline_access\") && !role.includes(\"uma_authorization\") && !role.includes(\"default-roles-spring-boot-microservices-realm\"));\r\n                    store.commit('setUserName', keycloak.tokenParsed.preferred_username)\r\n                    store.commit('setKeycloakToken', keycloak.token)\r\n                    store.commit('setKeycloakTokenParsed', keycloak.tokenParsed)\r\n                    store.commit('setRoles', roles)\r\n                    console.info('Token refreshed' + refreshed)\r\n                } else {\r\n                    console.warn('Token not refreshed, valid for ' + Math.round(keycloak.tokenParsed.exp + keycloak.timeSkew - new Date().getTime() / 1000) + ' seconds')\r\n                }\r\n            })\r\n            .catch(() => {\r\n                keycloak.logout()\r\n            })\r\n    }, 60 * 1000)\r\n})\r\n\r\napp.mount('#app')"]},"metadata":{},"sourceType":"module"}